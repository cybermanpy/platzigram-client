{"version":3,"sources":["client-test.js"],"names":["test","require","nock","platzigram","fixtures","options","endpoints","pictures","users","auth","beforeEach","t","context","client","createClient","is","getPicture","savePicture","likePicture","listPictures","listPicturesByTag","saveUser","getUser","image","getImage","get","publicId","reply","result","deepEqual","token","newImage","src","description","reqheaders","post","liked","likes","images","getImages","tag","user","newUser","username","name","email","password"],"mappings":"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","file":"client-test.js","sourcesContent":["'use strict'\r\n\r\nconst test = require('ava')\r\nconst nock = require('nock')\r\nconst platzigram = require('../')\r\nconst fixtures = require('./fixtures')\r\n\r\nlet options = {\r\n  endpoints: {\r\n    pictures: 'http://platzigram.test/picture',\r\n    users: 'http://platzigram.test/user',\r\n    auth: 'http://platzigram.test/auth'\r\n  }\r\n}\r\n\r\ntest.beforeEach(t => {\r\n  t.context.client = platzigram.createClient(options)\r\n})\r\n\r\ntest('client', t => {\r\n  const client = t.context.client\r\n\r\n  t.is(typeof client.getPicture, 'function')\r\n  t.is(typeof client.savePicture, 'function')\r\n  t.is(typeof client.likePicture, 'function')\r\n  t.is(typeof client.listPictures, 'function')\r\n  t.is(typeof client.listPicturesByTag, 'function')\r\n  t.is(typeof client.saveUser, 'function')\r\n  t.is(typeof client.getUser, 'function')\r\n  t.is(typeof client.auth, 'function')\r\n})\r\n\r\ntest('getPicture', async t => {\r\n  const client = t.context.client\r\n\r\n  let image = fixtures.getImage()\r\n\r\n  nock(options.endpoints.pictures)\r\n    .get(`/${image.publicId}`)\r\n    .reply(200, image)\r\n\r\n  let result = await client.getPicture(image.publicId)\r\n\r\n  t.deepEqual(image, result)\r\n})\r\n\r\ntest('savePicture', async t => {\r\n  const client = t.context.client\r\n\r\n  let token = 'xxx-xxx-xxx'\r\n  let image = fixtures.getImage()\r\n  let newImage = {\r\n    src: image.src,\r\n    description: image.description\r\n  }\r\n\r\n  nock(options.endpoints.pictures, {\r\n    reqheaders: {\r\n      'Authorization': `Bearer ${token}`\r\n    }\r\n  })\r\n    .post('/', newImage)\r\n    .reply(201, image)\r\n\r\n  let result = await client.savePicture(newImage, token)\r\n\r\n  t.deepEqual(result, image)\r\n})\r\n\r\ntest('likePicture', async t => {\r\n  const client = t.context.client\r\n\r\n  let image = fixtures.getImage()\r\n  image.liked = true\r\n  image.likes = 1\r\n\r\n  nock(options.endpoints.pictures)\r\n    .post(`/${image.publicId}/like`)\r\n    .reply(200, image)\r\n\r\n  let result = await client.likePicture(image.publicId)\r\n\r\n  t.deepEqual(image, result)\r\n})\r\n\r\ntest('listPictures', async t => {\r\n  const client = t.context.client\r\n\r\n  let images = fixtures.getImages(3)\r\n\r\n  nock(options.endpoints.pictures)\r\n    .get('/list')\r\n    .reply(200, images)\r\n\r\n  let result = await client.listPictures()\r\n\r\n  t.deepEqual(images, result)\r\n})\r\n\r\ntest('listPicturesByTag', async t => {\r\n  const client = t.context.client\r\n\r\n  let images = fixtures.getImages(3)\r\n  let tag = 'platzi'\r\n\r\n  nock(options.endpoints.pictures)\r\n    .get(`/tag/${tag}`)\r\n    .reply(200, images)\r\n\r\n  let result = await client.listPicturesByTag(tag)\r\n\r\n  t.deepEqual(images, result)\r\n})\r\n\r\ntest('saveUser', async t => {\r\n  const client = t.context.client\r\n\r\n  let user = fixtures.getUser()\r\n  let newUser = {\r\n    username: user.username,\r\n    name: user.name,\r\n    email: 'user@platzigram.test',\r\n    password: 'pl4tzi'\r\n  }\r\n\r\n  nock(options.endpoints.users)\r\n    .post('/', newUser)\r\n    .reply(201, user)\r\n\r\n  let result = await client.saveUser(newUser)\r\n\r\n  t.deepEqual(result, user)\r\n})\r\n\r\ntest('getUser', async t => {\r\n  const client = t.context.client\r\n\r\n  let user = fixtures.getUser()\r\n\r\n  nock(options.endpoints.users)\r\n    .get(`/${user.username}`)\r\n    .reply(200, user)\r\n\r\n  let result = await client.getUser(user.username)\r\n\r\n  t.deepEqual(result, user)\r\n})\r\n"]}